---
layout: post
title: Docker ì‹¤ìŠµ
date: 2023-11-09 18:23 +0900
categories:
  - ETC
  - Tech
tags: 
math: true
---

## Docker ì„¤ì¹˜

ë‹¤ìš´ë¡œë“œ url: https://www.docker.com/products/docker-desktop/

![](https://i.imgur.com/uggryKi.png)


## ì‹¤ìŠµ

### ultralytics/ultralytics

QuickStart url: https://docs.ultralytics.com/quickstart/#conda-docker-image

- **Dockerfile:**Â GPU image recommended for training.
- **Dockerfile-arm64:**Â Optimized for ARM64 architecture, allowing deployment on devices like Raspberry Pi and other ARM64-based platforms.
- **Dockerfile-cpu:**Â Ubuntu-based CPU-only version suitable for inference and environments without GPUs.
- **Dockerfile-jetson:**Â Tailored for NVIDIA Jetson devices, integrating GPU support optimized for these platforms.
- **Dockerfile-python:**Â Minimal image with just Python and necessary dependencies, ideal for lightweight applications and development.
- **Dockerfile-conda:**Â Based on Miniconda3 with conda installation of ultralytics package.

```sh
# Set image name as a variable
t=ultralytics/ultralytics:latest

# Pull the latest ultralytics image from Docker Hub
sudo docker pull $t

# Run the ultralytics image in a container with GPU support
`docker run -it --ipc=host docker.io/ultralytics/ultralytics:latest`
```

#### Docker run option ì„¤ëª…

-  `-it`
    - `-i` ì˜µì…˜ì€ ì»¨í…Œì´ë„ˆì˜ í‘œì¤€ ì…ë ¥(STDIN)ì„ ì—´ì–´ë‘ì–´ ëŒ€í™”í˜•ìœ¼ë¡œ ë§Œë“¤ê³ ,
    - `-t` ì˜µì…˜ì€ ê°€ìƒ í„°ë¯¸ë„(TTY)ì„ í• ë‹¹
    - í•¨ê»˜ ì‚¬ìš©í•  ê²½ìš° `-it`ëŠ” ì»¨í…Œì´ë„ˆì™€ì˜ ëŒ€í™”í˜• ì„¸ì…˜ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ì–´ ì‚¬ìš©ìê°€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì…¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨
-  `--ipc=host`
    - `--ipc` ì˜µì…˜ì€ IPC(Inter-Process Communication) ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
    - `host`ë¥¼ ì„¤ì •í•¨ìœ¼ë¡œì¨, ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ì˜ IPC ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©. ì¦‰, ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ë©”ëª¨ë¦¬ ê³µê°„ê³¼ ì„¸ë§ˆí¬ì–´ ë“± IPC ìì›ì„ ê³µìœ í•˜ê²Œ ë¨
    - ì´ëŠ” ì„±ëŠ¥ìƒì˜ ì´ìœ ë¡œ, íŠ¹íˆ ê³ ì„±ëŠ¥ ì»´í“¨íŒ… ì‘ì—…ì´ë‚˜ ë³‘ë ¬ ì²˜ë¦¬ ì‘ì—…ì„ í•  ë•Œ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì´ í•„ìš”í•  ê²½ìš° ìœ ìš©
-  `docker.io/ultralytics/ultralytics:latest`
    - ì´ ë¶€ë¶„ì€ ì‹¤í–‰í•˜ë ¤ëŠ” ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì§€ì •
    - `docker.io`: ë„ì»¤ í—ˆë¸Œì˜ ë„ë©”ì¸
    - `ultralytics/ultralytics`: ì‚¬ìš©ì/ë¦¬í¬ì§€í† ë¦¬ì˜ ì´ë¦„ìœ¼ë¡œ, ì—¬ê¸°ì„œ `ultralytics`ëŠ” ì‚¬ìš©ì í˜¹ì€ ì¡°ì§ì˜ ì´ë¦„ì´ë©°, ë‘ ë²ˆì§¸ `ultralytics`ëŠ” ì´ë¯¸ì§€ì˜ ì´ë¦„
    - `:latest`ëŠ” ì´ë¯¸ì§€ì˜ íƒœê·¸
    - `latest` íƒœê·¸ëŠ” í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì˜ ìµœì‹  ë²„ì „ ì´ë¯¸ì§€ë¥¼ ê°€ë¦¬í‚´. íƒœê·¸ë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ `latest` íƒœê·¸ê°€ ì‚¬ìš©
![](https://i.imgur.com/eyOvypk.png)
> cpu ë§Œ ì‚¬ìš©í•˜ëŠ” dockerë¡œ ì‹¤í–‰í•˜ì˜€ë‹¤


![](https://i.imgur.com/lkOOcfr.png)

### GPUë¥¼ ìœ„í•´ NVIDIA  ì„¤ì¹˜ ì‚¬ì´íŠ¸
https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html
### ë…¸íŠ¸

Ultralytics Dockerfile

```shell

# Ultralytics YOLO ğŸš€, AGPL-3.0 license
# Builds ultralytics/ultralytics:latest image on DockerHub https://hub.docker.com/r/ultralytics/ultralytics
# Image is CUDA-optimized for YOLOv8 single/multi-GPU training and inference

# Start FROM PyTorch image https://hub.docker.com/r/pytorch/pytorch or nvcr.io/nvidia/pytorch:23.03-py3
FROM pytorch/pytorch:2.1.0-cuda12.1-cudnn8-runtime
RUN pip install --no-cache nvidia-tensorrt --index-url https://pypi.ngc.nvidia.com

# Downloads to user config dir
ADD https://ultralytics.com/assets/Arial.ttf https://ultralytics.com/assets/Arial.Unicode.ttf /root/.config/Ultralytics/

# Install linux packages
# g++ required to build 'tflite_support' and 'lap' packages, libusb-1.0-0 required for 'tflite_support' package
RUN apt update \
    && apt install --no-install-recommends -y gcc git zip curl htop libgl1 libglib2.0-0 libpython3-dev gnupg g++ libusb-1.0-0

# Security updates
# https://security.snyk.io/vuln/SNYK-UBUNTU1804-OPENSSL-3314796
RUN apt upgrade --no-install-recommends -y openssl tar

# Create working directory
WORKDIR /usr/src/ultralytics

# Copy contents
# COPY . /usr/src/ultralytics  # git permission issues inside container
RUN git clone https://github.com/ultralytics/ultralytics -b main /usr/src/ultralytics
ADD https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.pt /usr/src/ultralytics/

# Install pip packages
RUN python3 -m pip install --upgrade pip wheel
RUN pip install --no-cache -e ".[export]" albumentations comet pycocotools pytest-cov

# Run exports to AutoInstall packages
RUN yolo export model=tmp/yolov8n.pt format=edgetpu imgsz=32
RUN yolo export model=tmp/yolov8n.pt format=ncnn imgsz=32
# Requires <= Python 3.10, bug with paddlepaddle==2.5.0 https://github.com/PaddlePaddle/X2Paddle/issues/991
RUN pip install --no-cache paddlepaddle==2.4.2 x2paddle
# Fix error: `np.bool` was a deprecated alias for the builtin `bool` segmentation error in Tests
RUN pip install --no-cache numpy==1.23.5
# Remove exported models
RUN rm -rf tmp

# Set environment variables
ENV OMP_NUM_THREADS=1
# Avoid DDP error "MKL_THREADING_LAYER=INTEL is incompatible with libgomp.so.1 library" https://github.com/pytorch/pytorch/issues/37377
ENV MKL_THREADING_LAYER=GNU


# Usage Examples -------------------------------------------------------------------------------------------------------

# Build and Push
# t=ultralytics/ultralytics:latest && sudo docker build -f docker/Dockerfile -t $t . && sudo docker push $t

# Pull and Run with access to all GPUs
# t=ultralytics/ultralytics:latest && sudo docker pull $t && sudo docker run -it --ipc=host --gpus all $t

# Pull and Run with access to GPUs 2 and 3 (inside container CUDA devices will appear as 0 and 1)
# t=ultralytics/ultralytics:latest && sudo docker pull $t && sudo docker run -it --ipc=host --gpus '"device=2,3"' $t

# Pull and Run with local directory access
# t=ultralytics/ultralytics:latest && sudo docker pull $t && sudo docker run -it --ipc=host --gpus all -v "$(pwd)"/datasets:/usr/src/datasets $t

# Kill all
# sudo docker kill $(sudo docker ps -q)

# Kill all image-based
# sudo docker kill $(sudo docker ps -qa --filter ancestor=ultralytics/ultralytics:latest)

# DockerHub tag update
# t=ultralytics/ultralytics:latest tnew=ultralytics/ultralytics:v6.2 && sudo docker pull $t && sudo docker tag $t $tnew && sudo docker push $tnew

# Clean up
# sudo docker system prune -a --volumes

# Update Ubuntu drivers
# https://www.maketecheasier.com/install-nvidia-drivers-ubuntu/

# DDP test
# python -m torch.distributed.run --nproc_per_node 2 --master_port 1 train.py --epochs 3

# GCP VM from Image
# docker.io/ultralytics/ultralytics:latest
```


 > ë§Œì•½ í”„ë¡œì íŠ¸ Dockerfileì„ ë§Œë“ ë‹¤ë©´, `FROM ultralytics/ultralytics`ë¡œ ì‹œì‘í•˜ì—¬ Dockerfileì„ ì‘ì„±í•˜ë©´ ë ê²ƒ ê°™ë‹¤


### Mount

í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ íŒŒì¼ ë˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ íŒŒì¼ì‹œìŠ¤í…œì— ì—°ê²°í•˜ëŠ” ê²ƒì„ ì˜ë¯¸

1. **ë³¼ë¥¨(Volume) ë§ˆìš´íŠ¸**:
    
    - ë³¼ë¥¨ì€ ë„ì»¤ í˜¸ìŠ¤íŠ¸ì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ë°ì´í„°ì˜ ì €ì¥ì†Œì…ë‹ˆë‹¤. ë³¼ë¥¨ì€ ì»¨í…Œì´ë„ˆê°€ ì‚­ì œë˜ì–´ë„ ë‚¨ì•„ìˆê³ , ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆê°€ ë™ì‹œì— ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ë©´ í˜¸ìŠ¤íŠ¸ íŒŒì¼ì‹œìŠ¤í…œì˜ íŠ¹ì • ìœ„ì¹˜ì— ì¢…ì†ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, íœ´ëŒ€ì„±ê³¼ ë³´ì•ˆì— ìœ ë¦¬í•©ë‹ˆë‹¤.
    - ì˜ˆ: `docker run -v my_volume:/path/in/container ...`
2. **ë°”ì¸ë“œ ë§ˆìš´íŠ¸**:
    
    - í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ì–´ë–¤ íŒŒì¼ì´ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ë°”ì¸ë“œ ë§ˆìš´íŠ¸ëŠ” í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ íŠ¹ì • ê²½ë¡œë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ë©°, ê°œë°œ í™˜ê²½ì—ì„œ ì½”ë“œë¥¼ ë¹ ë¥´ê²Œ ë°˜ì˜í•˜ê¸° ìœ„í•´ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.
    - ë°”ì¸ë“œ ë§ˆìš´íŠ¸ëŠ” ë³¼ë¥¨ ë§ˆìš´íŠ¸ë³´ë‹¤ í˜¸ìŠ¤íŠ¸ì— ë” ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆì–´, íŒŒì¼ì‹œìŠ¤í…œì˜ ê²½ë¡œì— ì˜ì¡´í•©ë‹ˆë‹¤.
    - ì˜ˆ: `docker run -v /path/on/host:/path/in/container ...`
3. **tmpfs ë§ˆìš´íŠ¸**:
    
    - í˜¸ìŠ¤íŠ¸ì˜ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ëŠ” ì¼ì‹œì ì¸ íŒŒì¼ì‹œìŠ¤í…œì„ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ë©´, tmpfsì— ì €ì¥ëœ ë°ì´í„°ëŠ” ì‚­ì œë©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì²˜ë¦¬í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
    - ì˜ˆ: `docker run --tmpfs /path/in/container ...`

ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œì˜ ëª‡ ê°€ì§€ ì£¼ì˜ì‚¬í•­:

- **ë³¼ë¥¨ ë§ˆìš´íŠ¸**ëŠ” í˜¸ìŠ¤íŠ¸ì— ì¢…ì†ë˜ì§€ ì•Šì•„ ì—¬ëŸ¬ ë„ì»¤ í˜¸ìŠ¤íŠ¸ì—ì„œ ë³¼ë¥¨ì„ ì‰½ê²Œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë°”ì¸ë“œ ë§ˆìš´íŠ¸**ëŠ” í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ êµ¬ì²´ì ì¸ ê²½ë¡œë¥¼ ì»¨í…Œì´ë„ˆì— ì—°ê²°í•˜ë¯€ë¡œ, ê°œë°œ í™˜ê²½ì—ì„œëŠ” í¸ë¦¬í•˜ì§€ë§Œ ë°°í¬ í™˜ê²½ì—ì„œëŠ” ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
- ë„ì»¤ ì»´í¬ì¦ˆ(Docker Compose)ë¥¼ ì‚¬ìš©í•˜ë©´ ë³¼ë¥¨ê³¼ ë°”ì¸ë“œ ë§ˆìš´íŠ¸ë¥¼ ë” ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ” ì „í˜•ì ì¸ `docker run` ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

bashCopy code

`docker run -v type=volume,source=my_volume,target=/path/in/container ...`

í˜¹ì€ ë°”ì¸ë“œ ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

bashCopy code

`docker run -v /path/on/host:/path/in/container ...`

ì´ë ‡ê²Œ ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´, ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ `/path/in/container`ì— í˜¸ìŠ¤íŠ¸ì˜ `/path/on/host`ê°€ ì—°ê²°ë˜ì–´, ì»¨í…Œì´ë„ˆì—ì„œ í•´ë‹¹ ê²½ë¡œë¥¼ í†µí•´ íŒŒì¼ì„ ì½ê³  ì“¸ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.