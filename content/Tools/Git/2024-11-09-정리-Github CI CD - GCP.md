---
layout: post
title: "[ì •ë¦¬]Github CI/CD - GCP"
date: 2024-11-09 16:55 +0900
categories:
  - ETC
  - Github
tags:
  - CI/CD
  - github
math: true
---

## Intro:

GCPì— ê°œì¸ ì„œë²„ë¥¼ ë§Œë“¤ê³ , ê´€ë¦¬í•˜ë ¤ëŠ”ë°, CI/CDë¥¼ ë§Œë“¤ì–´ë†”ì•¼ ì‹œê°„ ì ˆì•½ì„ í•  ìˆ˜ ìˆì„ê²ƒ ê°™ì•„ ê³µë¶€í•´ë³´ë ¤ í•œë‹¤.

## CI/CDë€?

- **CI/CD**ëŠ” Continuous Integrationê³¼ Continuous Deploymentì˜ ì•½ìë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ê³¼ì •ì—ì„œ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬í•˜ëŠ” ì¼ë ¨ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ë¯¸
- ì½”ë“œ ìˆ˜ì • í›„ ìˆ˜ë™ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ë²ˆê±°ë¡œì›€ ì—†ì´ ìë™í™”ëœ ì‹œìŠ¤í…œìœ¼ë¡œ ë¹ ë¥´ê³  ì•ˆì •ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤

### Continuous Integration (CI)

- **ì§€ì†ì  í†µí•©**: ì—¬ëŸ¬ ê°œë°œìê°€ ì‘ì—…í•œ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ì •ê¸°ì ìœ¼ë¡œ ì¤‘ì•™ ë¦¬í¬ì§€í† ë¦¬ì— ë³‘í•©í•˜ê³ , ì´ ë³‘í•©ëœ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ê³¼ì •
- ì½”ë“œ ì¶©ëŒì„ ìµœì†Œí™”í•˜ê³ , ë¬¸ì œë¥¼ ì¡°ê¸°ì— ë°œê²¬í•˜ì—¬ í’ˆì§ˆì„ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ëœë‹¤

### Continuous Deployment (CD)

- **ì§€ì†ì  ë°°í¬**: CI ê³¼ì •ì„ ê±°ì¹œ ì½”ë“œê°€ ìë™ìœ¼ë¡œ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬ë˜ëŠ” ê²ƒì„ ì˜ë¯¸
- ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ë‚˜ ìˆ˜ì • ì‚¬í•­ì„ ì‚¬ìš©ìì—ê²Œ ì‹ ì†í•˜ê²Œ ì œê³µ
- ë°°í¬ ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì¸ì  ì˜¤ë¥˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤

### CI/CDì˜ ì¥ì 

- **ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤**: ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬ ê³¼ì •ì„ ìë™í™”í•˜ì—¬ íš¨ìœ¨ì„± í–¥ìƒ
- **ë¹ ë¥¸ í”¼ë“œë°± ë£¨í”„**: ì½”ë“œ ë³€ê²½ì— ëŒ€í•œ ì¦‰ê°ì ì¸ í”¼ë“œë°±ìœ¼ë¡œ ë¹ ë¥¸ ë¬¸ì œ í•´ê²°
- **ë†’ì€ ì½”ë“œ í’ˆì§ˆ**: ì§€ì†ì ì¸ í…ŒìŠ¤íŠ¸ì™€ ê²€ì¦ìœ¼ë¡œ ì•ˆì •ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ì œê³µ
- **í˜‘ì—… ê°œì„ **: ì—¬ëŸ¬ ê°œë°œìê°€ ë™ì‹œì— ì‘ì—…í•´ë„ í†µí•© ê³¼ì •ì´ ì›í™œí•˜ì—¬ íŒ€ ìƒì‚°ì„±ì´ í–¥ìƒ

### GCPì—ì„œì˜ CI/CD ì ìš©

- Google Cloud Platform(GCP)ì€ Cloud Build, Cloud Deploy ë“± ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì œê³µí•œë‹¤. 
- í•˜ì§€ë§Œ, ë‚˜ëŠ” Github Actionsë¥¼ ê³µë¶€ ëª©ì ìœ¼ë¡œ ìœ„ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.



## GitHub Actionsë€?

**GitHub Actions**ëŠ” GitHubì—ì„œ ì œê³µí•˜ëŠ” CI/CD(ì§€ì†ì  í†µí•© ë° ì§€ì†ì  ë°°í¬) í”Œë«í¼ìœ¼ë¡œ, ë¦¬í¬ì§€í† ë¦¬ ë‚´ì—ì„œ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬ ë“±ì˜ ì›Œí¬í”Œë¡œë¥¼ ìë™í™”í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì´ë‹¤.

[GitHub Docs](https://docs.github.com/ko/actions)

### ì£¼ìš” êµ¬ì„± ìš”ì†Œ

- **ì›Œí¬í”Œë¡œ(Workflow)**: ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” YAML íŒŒì¼ë¡œ, `.github/workflows` ë””ë ‰í„°ë¦¬ì— ìœ„ì¹˜í•œë‹¤.
    
- **ì´ë²¤íŠ¸(Event)**: ì›Œí¬í”Œë¡œë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ë¦¬í¬ì§€í† ë¦¬ ë‚´ì˜ íŠ¹ì • í™œë™ìœ¼ë¡œ, ì˜ˆë¥¼ ë“¤ì–´ ì½”ë“œ í‘¸ì‹œ, í’€ ë¦¬í€˜ìŠ¤íŠ¸ ìƒì„± ë“±ì´ ìˆë‹¤.
    
- **ì¡(Job)**: ì›Œí¬í”Œë¡œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‘ì—… ë‹¨ìœ„ë¡œ, ì—¬ëŸ¬ ìŠ¤í…(Step)ìœ¼ë¡œ êµ¬ì„±ë˜ë©°, ê° ì¡ì€ ë…ë¦½ì ì¸ ê°€ìƒ í™˜ê²½ì—ì„œ ì‹¤í–‰ëœë‹¤.
    
- **ìŠ¤í…(Step)**: ì¡ ë‚´ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê°œë³„ ì‘ì—…ìœ¼ë¡œ, ì…¸ ìŠ¤í¬ë¦½íŠ¸ë‚˜ ì•¡ì…˜(Action)ì„ ì‹¤í–‰í•œë‹¤.
    
- **ì•¡ì…˜(Action)**: ìì£¼ ì‚¬ìš©ë˜ëŠ” ì‘ì—…ì„ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“  ì½”ë“œ ì¡°ê°ìœ¼ë¡œ, GitHub Marketplaceì—ì„œ ë‹¤ì–‘í•œ ì•¡ì…˜ì„ ì°¾ì•„ í™œìš©í•  ìˆ˜ ìˆë‹¤.

### GitHub Actionsì˜ ì¥ì 

- **ìë™í™”ëœ ì›Œí¬í”Œë¡œ**: ì½”ë“œ í‘¸ì‹œ, í’€ ë¦¬í€˜ìŠ¤íŠ¸ ë“± ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ì— ë°˜ì‘í•˜ì—¬ ìë™ìœ¼ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
    
- **ë‹¤ì–‘í•œ í™˜ê²½ ì§€ì›**: Linux, macOS, Windows ë“± ë‹¤ì–‘í•œ ìš´ì˜ì²´ì œì—ì„œ ì›Œí¬í”Œë¡œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
    
- **ì»¤ë®¤ë‹ˆí‹° ì•¡ì…˜ í™œìš©**: GitHub Marketplaceì—ì„œ ì œê³µë˜ëŠ” ë‹¤ì–‘í•œ ì•¡ì…˜ì„ í™œìš©í•˜ì—¬ ì›Œí¬í”Œë¡œë¥¼ ì†ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
    

### ì‚¬ìš© ì˜ˆì‹œ

ì˜ˆë¥¼ ë“¤ì–´, ì½”ë“œê°€ í‘¸ì‹œë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ì›Œí¬í”Œë¡œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```yaml
name: CI Pipeline
on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '14'
      - name: Install dependencies
        run: npm install
      - name: Run tests
        run: npm test

```
ì´ëŸ¬í•œ ì„¤ì •ì„ í†µí•´ ì½”ë“œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ë¹Œë“œì™€ í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ë˜ì–´ ê°œë°œ íš¨ìœ¨ì„±ê³¼ ì½”ë“œ í’ˆì§ˆì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.

GitHub Actionsë¥¼ í™œìš©í•˜ë©´ GCPì— ì¢…ì†ë˜ì§€ ì•Šê³ ë„ íš¨ìœ¨ì ì¸ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì—¬ ê°œë°œ ë° ë°°í¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•  ìˆ˜ ìˆë‹¤.


## ì„œë²„ì—ì„œ ì½”ë“œë¥¼ ì„œë²„ì—ì„œ docker build ë°©ì‹ vs docker pull/push ì‚¬ìš© ë°©ì‹

### 1. ì½”ë“œë¥¼ ì„œë²„ì—ì„œ docker build ì‹¤í–‰

ì• í”Œë¦¬ì¼€ì´ì…˜ **ì†ŒìŠ¤ ì½”ë“œì™€ ë„ì»¤ ê´€ë ¨ íŒŒì¼**(ì˜ˆ: Dockerfile, docker-compose.yaml, .env ë“±)ì„ ì„œë²„ë¡œ ì§ì ‘ ë³µì‚¬í•œ ë’¤, ì„œë²„ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œë‹¤.
  

#### íŠ¹ì§•
â€¢ **ì½”ë“œë¥¼ ì§ì ‘ ì„œë²„ë¡œ ë³µì‚¬**
â€¢ ì„œë²„ì—ì„œ ë§¤ë²ˆ ìƒˆë¡œ docker buildë¥¼ ì‹¤í–‰
â€¢ **ê°„ë‹¨í•˜ê³  ì§ê´€ì **ì´ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ì :
1. ì„œë²„ë§ˆë‹¤ ì½”ë“œ ë³µì‚¬ì™€ ë¹Œë“œ ê³¼ì •ì´ í•„ìš”
2. ë¹Œë“œ í™˜ê²½ì— ë”°ë¼ ë¹Œë“œ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤
3. ë¯¼ê°í•œ ì •ë³´(.env, ì†ŒìŠ¤ ì½”ë“œ ë“±)ê°€ ì„œë²„ì— ë…¸ì¶œë  ìœ„í—˜ì´ ìˆë‹¤
4. ë™ì¼í•œ ì´ë¯¸ì§€ë¥¼ ì—¬ëŸ¬ ì„œë²„ì— ë°°í¬í•  ë•Œ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤


### 2. Docker Push/Pull ë°©ì‹

**ë¡œì»¬ ë˜ëŠ” CI/CD ì„œë²„**ì—ì„œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œ ë’¤, ì´ë¯¸ì§€ë¥¼ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬(Docker Hub, GCP Artifact Registry ë“±)ì— í‘¸ì‹œí•œë‹¤. ì„œë²„ëŠ” ì´ë¯¸ì§€ë¥¼ í‘¸ì‹œí•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ docker pullë¡œ ë‚´ë ¤ë°›ì•„ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œë‹¤.


#### íŠ¹ì§•
â€¢ **ì½”ë“œë¥¼ ì„œë²„ë¡œ ë³µì‚¬í•˜ì§€ ì•Šê³ **, ë¹Œë“œëœ ì´ë¯¸ì§€ë§Œ ì„œë²„ì—ì„œ ë‚´ë ¤ë°›ì•„ ì‚¬ìš©
â€¢ ë¹Œë“œì™€ ë°°í¬ê°€ ë¶„ë¦¬ë˜ì–´ ìˆì–´ **ì¼ê´€ëœ ë¹Œë“œ í™˜ê²½**ì„ ë³´ì¥
â€¢ **ì´ë¯¸ì§€ í‘¸ì‹œ/í’€ ê³¼ì •**ì´ í•„ìš”í•˜ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì´ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ, ì—¬ëŸ¬ ì„œë²„ì— ë™ì¼í•œ ì´ë¯¸ì§€ë¥¼ ë°°í¬í•  ë•Œ íš¨ìœ¨ì ì´ë‹¤


### ì°¨ì´ì  ë¹„êµ

|**í•­ëª©**|**ì„œë²„ì—ì„œ `docker build`**|**Docker Push/Pull**|
|---|---|---|
|**ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬**|ì„œë²„ë¡œ ì§ì ‘ ë³µì‚¬|ì„œë²„ë¡œ ë³µì‚¬í•˜ì§€ ì•ŠìŒ|
|**ë¹Œë“œ ìœ„ì¹˜**|ì„œë²„ì—ì„œ ë¹Œë“œ|ë¡œì»¬ ë˜ëŠ” CI/CD ì„œë²„ì—ì„œ ë¹Œë“œ|
|**ë°°í¬ íš¨ìœ¨ì„±**|ì„œë²„ë§ˆë‹¤ ë³„ë„ë¡œ ë¹Œë“œ í•„ìš”|ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥ í›„ ì—¬ëŸ¬ ì„œë²„ì—ì„œ `pull`|
|**ì¼ê´€ì„±**|ì„œë²„ í™˜ê²½ì— ë”°ë¼ ë¹Œë“œ ê²°ê³¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ|ë™ì¼í•œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì¼ê´€ì„± ë³´ì¥|
|**ë¯¼ê° ì •ë³´ ê´€ë¦¬**|ì½”ë“œì™€ `.env` íŒŒì¼ì´ ì„œë²„ì— ë…¸ì¶œë  ê°€ëŠ¥ì„± ìˆìŒ|`.env` íŒŒì¼ì€ ì„œë²„ì—ì„œë§Œ ê´€ë¦¬|
|**ë³µì¡ë„**|ë‹¨ìˆœí•¨|ì•½ê°„ì˜ ì´ˆê¸° ì„¤ì • í•„ìš” (ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ê²° ë“±)|
|**ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©**|ì½”ë“œ ì—…ë¡œë“œ (ì†ŒëŸ‰)|ì´ë¯¸ì§€ í‘¸ì‹œ/í’€ (ëŒ€ëŸ‰)|

> ë‚˜ëŠ” ì‚¬ì‹¤ 1ë²ˆ ë°©ë²•ì„ ìˆ˜ë™ìœ¼ë¡œ ì£¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆì—ˆìœ¼ë‚˜, 2ë²ˆ ë°©ë²•ì„ Github Actions CI/CDë¡œ ì‚¬ìš©í•˜ê³ ì í•œë‹¤


##  í…ŒìŠ¤íŠ¸: Github Actionì„ ì´ìš©í•œ CI/CD ì ìš© sample test


ì°¸ê³  ìë£Œ: [https://docs.github.com/en/actions/about-github-actions/understanding-github-actions](https://docs.github.com/en/actions/about-github-actions/understanding-github-actions) 


### Sample Workflow Test


Github Documentation ì œê³µ ê¸°ë³¸ `github-actions-demo.yml`. `.github/workflows/` ìœ„ì¹˜ì— ì €ì¥í•´ì•¼ í•œë‹¤


```bash
mkdir -p .github/workflows/
```

```yaml
name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "ğŸ This job's status is ${{ job.status }}."

```


![](https://i.imgur.com/Hek3ndh.png)

Githubì— push ì‹œ ì•„ë˜ì™€ ê°™ì´ Github Actionì´ ë™ì‘í•œë‹¤ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


![](https://i.imgur.com/0ijXeL7.png)
![](https://i.imgur.com/tij8pdJ.png)
![](https://i.imgur.com/95M2ztm.png)




