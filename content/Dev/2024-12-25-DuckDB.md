---
layout: post
title: DuckDB
date: 2024-12-25 17:30 +0900
categories:
  - ETC
  - Tech
tags: 
math: true
---

### 목차

1. DuckDB란?
2. DuckDB의 주요 특징
3. DuckDB vs SQLite
4. Python에서 DuckDB 사용하기
5. DuckDB 활용 사례
6. 언제 DuckDB를 선택해야 하는가?
7. 언제 다른 것이 나은가?
8. 결론

---

### 1. DuckDB란?

DuckDB는 OLAP(Online Analytical Processing) 작업을 위해 설계된 경량형 임베디드 데이터베이스로, "분석을 위한 SQLite"라고 불린다.  
C++로 작성되어 고성능 쿼리 처리를 지원하며, 단일 파일 기반으로 별도의 설치나 설정 없이 사용할 수 있다. SQL 표준을 준수하며 직관적이고 강력한 SQL 쿼리 언어를 제공한다.

---

### 2. DuckDB의 주요 특징

#### Local

DuckDB는 in-process 데이터베이스로 단일 파일 기반(Sqlite와 비슷)

- 외부 의존성이 없어 별도의 설치나 설정 없이 바로 사용 가능
- 클라이언트-서버 모델(Postgres 등)과 달리 네트워크 연결이나 추가 설정이 필요하지 않음
- 데이터베이스가 애플리케이션 내부에 포함되어 있어 로컬 데이터 분석에 최적화
- 데이터 전송이 불필요하여 로컬 설치 환경에서 더 빠르게 작동

#### Performances

DuckDB는 OLAP 작업을 위해 고도로 최적화

*OLAP란? OLAP(Online Analytical Processing)는 대량의 데이터를 분석하고 집계하는 데 최적화된 데이터 처리 방식

- 컬럼 지향 저장 방식을 사용해 집계, 조인, 읽기 작업을 빠르게 처리한다.
- 벡터화된 쿼리 실행 방식을 통해 CPU 활용을 극대화하며, 다중 CPU 코어를 병렬로 활용할 수 있다.
- Pandas와 비교해 메모리 효율성이 뛰어나며, 메모리 한계를 초과하는 데이터도 안정적으로 처리할 수 있다.
- 복잡하고 긴 쿼리도 빠르게 처리하며, 단일 머신에서 대부분의 대규모 데이터 작업을 수행할 수 있다.

#### SQL

DuckDB는 SQL을 중심으로 데이터 처리를 간소화한다.

- 전통적인 SQL 문법과 더불어 윈도우 함수, 집계 함수 등 고급 기능을 제공한다.
- Postgres API를 기반으로 ACID 트랜잭션을 보장하여 안정적인 데이터 처리가 가능하다.
- Pandas의 복잡한 데이터 조작 대신 직관적인 SQL로 동일한 작업을 수행할 수 있다.
- Arrow, Parquet와의 네이티브 통합을 지원하며, Python 클라이언트를 통해 다양한 데이터 과학 도구와 쉽게 연계할 수 있다.

#### Limitations

DuckDB는 강력한 도구이지만 몇 가지 한계가 있다.

- 단일 머신 기반으로 설계되어 데이터가 머신의 메모리 한계를 초과할 경우 적합하지 않다.
- 다중 사용자 환경이나 멀티 테넌트 작업에는 부적합하다.
- 트랜잭션 중심의 OLTP 데이터베이스로 설계되지 않았으므로, 복잡한 트랜잭션 작업에는 SQLite나 Postgres 같은 대안을 고려해야 한다.
    

---

### 3. DuckDB vs SQLite

#### DuckDB와 SQLite의 공통점

- 단일 파일 데이터베이스로 별도의 서버가 필요하지 않다.
- 경량형으로 임베디드 환경에서도 사용할 수 있다.
- ACID 트랜잭션을 지원해 데이터 무결성을 보장한다.

#### DuckDB의 차별점

- 컬럼 지향 저장 방식으로 대규모 데이터 집계와 분석에 최적화되어 있다. SQLite는 로우 지향 저장 방식으로 개별 행의 읽기/쓰기에 적합하다.
- 벡터화된 쿼리 실행 방식으로 대규모 데이터를 빠르게 처리하며, SQLite는 단순 검색과 트랜잭션 중심 작업에서 유리하다.
- 멀티 스레드 활용이 가능해 병렬 쿼리 처리를 지원한다. SQLite는 단일 스레드 기반으로 동시 쓰기가 제한된다.
- 다양한 데이터 형식을 직접 쿼리할 수 있다. DuckDB는 CSV, Parquet, Arrow 등의 데이터를 직접 로드할 수 있지만, SQLite는 외부 데이터를 SQL로 삽입하여 처리해야 한다.
- DuckDB는 데이터 분석, 대규모 집계, 머신러닝 파이프라인 작업에 적합하다. SQLite는 임베디드 시스템과 간단한 트랜잭션 관리에 더 적합하다.

---

### 4. Python에서 DuckDB 사용하기

#### 설치 및 환경 설정

```bash
pip install duckdb
```


#### DuckDB 연결 설정

DuckDB는 인메모리 데이터베이스와 영구 데이터베이스 두 가지 방식으로 연결할 수 있다.

- 인메모리 데이터베이스: `duckdb.connect()`
- 영구 데이터베이스: `duckdb.connect("my_db.db")`

#### 데이터 쿼리

다양한 파일 형식을 SQL처럼 쿼리할 수 있다.


```python
conn = duckdb.connect() df = conn.sql("""     SELECT *     FROM 'dataset/*.csv'     LIMIT 10 """).df()
```


#### 테이블 생성 및 조회

Pandas DataFrame을 DuckDB 테이블로 등록할 수 있다.



```python
conn.register("df_view", df) print(conn.execute("DESCRIBE df_view").df())
```

---

### 5. DuckDB 활용 사례

- 데이터 과학 및 분석  
    DuckDB는 Pandas와 직접 통합 가능하며, 대규모 데이터도 처리할 수 있다. SQL 쿼리를 활용해 복잡한 데이터 조작을 수행할 수 있다.
    
- ETL 작업  
    Parquet, Arrow 파일에서 데이터를 추출하고 처리할 수 있다. Pandas를 대체하거나 보완하여 데이터 파이프라인을 구축할 수 있다.
    
- 대규모 데이터 처리  
    단일 머신에서 효율적으로 OLAP 작업을 수행할 수 있다. AWS S3와 같은 스토리지와도 통합 가능하다.
    

---

### 6. 언제 DuckDB를 선택해야 하는가?

- **데이터 분석 및 OLAP 작업이 주를 이룰 때**  
    복잡한 SQL 쿼리, 집계, 윈도우 함수, 다중 테이블 간 조인 등 분석 중심의 작업이 필요할 때 DuckDB가 적합하다.
    
- **로컬 환경에서 대규모 데이터를 처리할 때**  
    CSV, Parquet, Arrow와 같은 대용량 데이터 파일을 SQL로 직접 쿼리해야 하는 경우 DuckDB가 유리하다. Pandas보다 성능이 뛰어나고 메모리 문제를 덜 겪는다.
    
- **Python, R, Julia와의 통합이 필요할 때**  
    데이터 과학 도구들과 원활히 작동하며, Pandas DataFrame, Arrow 테이블 등과 직접적으로 연계할 수 있다.
    
- **멀티 코어를 활용한 병렬 처리가 필요할 때**  
    다중 CPU 코어를 활용하여 데이터 분석 속도를 높일 수 있다.
    
- **데이터베이스 설치나 설정에 시간이 부족할 때**  
    DuckDB는 별도의 클라이언트-서버 설정 없이 단일 파일로 실행되므로 간단하게 사용할 수 있다.
    

---

### 7. 언제 다른 것이 나은가?

- **트랜잭션 중심의 OLTP 작업이 필요할 때**  
    자주 읽고 쓰는 트랜잭션 관리가 중요하다면 SQLite나 Postgres 같은 전통적인 OLTP 데이터베이스가 더 적합하다.
    
- **분산 처리가 필요한 경우**  
    단일 머신을 넘어 여러 노드로 데이터를 분산 처리해야 한다면 Spark, Dask, BigQuery와 같은 도구를 선택해야 한다.
    
- **다중 사용자 환경이 요구될 때**  
    여러 사용자가 동시에 데이터베이스에 접근하거나 데이터를 공유해야 한다면 PostgreSQL 또는 MySQL 같은 서버 기반 DBMS가 더 적합하다.
    
- **임베디드 시스템에서 경량 DB가 필요할 때**  
    단순 트랜잭션 관리와 로우 지향 데이터 저장이 필요하다면 SQLite가 더 적합하다.
    
- **대용량 데이터 웨어하우스 구축 시**  
    테라바이트 이상의 데이터를 다루고 클라우드 기반 확장이 필요하다면 Snowflake, Redshift, MotherDuck 같은 솔루션이 더 효율적이다. 
### 8. 결론

DuckDB는 가볍고 강력한 데이터 분석 도구로, SQLite와는 다른 목적과 성능을 지향한다.  
데이터 분석과 집계에 최적화된 컬럼 지향 저장 방식과 멀티 스레드 지원으로 단일 머신에서 효율적인 데이터 처리가 가능하다. SQL 표준을 준수하면서 다양한 데이터 형식을 지원해 분석 워크플로우를 간소화한다.

SQLite가 트랜잭션 중심의 경량 데이터베이스라면, DuckDB는 데이터 분석을 위한 강력한 솔루션이다. 두 시스템의 차이를 명확히 이해하고 적절한 작업에 적용하면 효율성을 극대화할 수 있다.

DuckDB는 데이터 과학자와 분석가를 위한 최고의 선택 중 하나이다.