name: Sync to AppHub AI

on:
  push:
    branches:
      - main
    paths:
      - 'content/**'  # content 디렉토리 변경 시에만 실행

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout blog repository
        uses: actions/checkout@v4
        with:
          path: blog

      - name: Checkout apphub-ai repository
        uses: actions/checkout@v4
        with:
          repository: syshin0116/apphub-ai
          token: ${{ secrets.APPHUB_DISPATCH_TOKEN }}
          path: apphub-ai

      - name: Update blog content in apphub-ai
        run: |
          # apphub-ai의 data/blog로 이동
          cd apphub-ai/data/blog

          # 최신 블로그 content 가져오기
          git pull origin main

          # apphub-ai 루트로 이동
          cd ../..

          # Git 설정
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # 변경사항 확인 및 커밋
          if git diff --quiet data/blog; then
            echo "No changes to blog content"
          else
            git add data/blog
            git commit -m "chore: sync blog content from ${{ github.sha }}"
            git push
            echo "Blog content updated successfully"
          fi
